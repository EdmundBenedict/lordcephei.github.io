---
layout: page-fullwidth
title: "ASA Green's function package tutorial"
subheadline: ""
show_meta: false
teaser: ""
permalink: "/lmgf-tutorial/"
header: no
---

### _Table of Contents_
{:.no_toc}
*  Auto generated table of contents
{:toc} 

### _Preliminaries_
_____________________________________________________________
For this tutorial the **blm**{: style="color: blue"}, **lmchk**{: style="color: blue"}, **lmstr**{: style="color: blue"}, **lm**{: style="color: blue"} and **lmgf**{: style="color: blue"} executibles are required and are assumed to be in your PATH; the source code for all Questaal exectuables can be found [here](https://bitbucket.org/lmto/lm).


### _Purpose_
_____________________________________________________________
This package implements the ASA local spin-density approximation using Green's functions. The Green's functions are contructed by approximating KKR multiple-scattering theory with an analytic potential function. The approximation to KKR is essentially similar to the linear approximation employed in band methods such as LMTO and LAPW. It can be shown that this approximation is nearly equivalent to the LMTO hamiltonian without the "combined correction" term. With this package a new program, **lmgf**{: style="color: blue"} is added to the suite of executables. **lmgf**{: style="color: blue"} plays approximately the same role as the LMTO-ASA band program **lm**{: style="color: blue"}: a potential is generated from energy moments $$Q_0$$, $$Q_1$$, and $$Q_2$$ of the density of states. in the same way as the **lm**{: style="color: blue"} code. You can use **lmgf**{: style="color: blue"} to make a self-consistent density as you can do with **lm**{: style="color: blue"}. lmgf is a Green's function method: Green's functions have less information than wave functions, so in one sense the things you can do with lmgf are more limited: you cannot make the bands directly, for example. However **lmgf**{: style="color: blue"} enables you do do things you cannot do with **lm**{: style="color: blue"}. The two most imprortant are:

+ Calculate magnetic exchange interactions 
+ Calculate magnetic susceptibility (spin-spin, spin-orbit, orbit-orbit parts)
+ Calculate properties of disordered materials, either chemically disordered or spin disorder from finite temperature, within the Coherent Potential Approximation, or CPA.
+ Calculate the ASA static susceptibility at $$q=0$$ to help converge calculations to self-consistency. 

**You can find some extra information on the way** **lmgf**{: style="color: blue"} **works in** [lmgf documentation](https://lordcephei.github.io/lmgf-documentation/).

##### _lmgf vs lm_


**lmgf**{: style="color: blue"} is a Green's function program complementary to the ASA band code **lm**{: style="color: blue"}. For some properties, e.g. calculating moments $$Q_{0..2}$$ **lmgf**{: style="color: blue"} can be straightforwardly substituted for lm because both calculate the DOS. The DOS is $$1/(2\pi ) {\rm Im} G$$: it can be decomposed into site contributions and thus moments Q0..2 can be generated for each site and l channel, as an alternative to decomposing the eigenfunctions of the bands, as lm does. Thus it can achieve self-consistency in a manner similar to lm, but generating $$Q_{0..2,{\bf R}l}$$ by an alternate route. If the ASA hamiltionian built by lm is suitably simplified, i.e. by

+ omitting the "combined correction term" (**OPTIONS_ASA_CCOR**)
+ generating $$Q_{0..2,{\bf R}l}$$ from true power moments as the Green's function does (**HAM_QASA=0**), 

then **lmgf**{: style="color: blue"} and **lm**{: style="color: blue"} will produce nearly identical self-consistent solutions. When potential functions are parameterized to 2nd order in both **lm**{: style="color: blue"} and **lmgf**{: style="color: blue"}, and both methods are fully k converged, they should product nearly identical results. By default lm parameterizes the potential function to 3rd order; **lmgf**{: style="color: blue"} can do the same. The 3rd order parameterizations are similar in the two methods, but not identical. To verify this, try the following test:

~~~
gf/test/test.gf co 1 2   ‚Üê Test 1 for 2nd order parameterization; test 2 for 3rd order
~~~

**lmgf**{: style="color: blue"} is a bit messier to work with (Green's functions are harder to stabilize than wave functions), and it a bit less accurate as the simplifications to lm amount to approximations. So, typically lm makes a better self-consistent potential.

But **lmgf**{: style="color: blue"} can do things **lm**{: style="color: blue"} doesn't do, e.g. calculate magnetic exchange interactions through linear response as this tutorial demonstrates. Sometimes there is a need or advantage to carrying self-consistency via **lmgf**{: style="color: blue"}, e.g. when performing CPA calculations. Unless there is good reason to do otherwise, it is better use the self-consistent potential generated by **lm**{: style="color: blue"} to calculate other properties such as the magnetic exchange parameters. We follow that strategy here. 

### _Tutorial_
_____________________________________________________________

##### _1\. Building an input file_

Before starting working with this tutorial we advise you to read through the [ASA-tutorial](https://lordcephei.github.io/asa-doc/) which explains building the imput file in more details (you can also look through the input described in a [full-potential context](https://lordcephei.github.io/buildingfpinput/)). In the present tutorial we'll focus on the part of the input specific for using with **lmgf**{: style="color: blue"}.

To get started, **copy** **doc/demos/asa-copt/init.copt**{: style="color: green"} to your working directory. Inspect the init file and you will see it contains just the minimum structural information, apart from one line supplying some information about the magnetic structure:

<div onclick="elm = document.getElementById('foobar'); if(elm.style.display == 'none') elm.style.display = 'block'; else elm.style.display = 'none';"><button type="button" class="button tiny radius">Click to show.</button></div>
{::nomarkdown}<div style="display:none;margin:0px 25px 0px 25px;"id="foobar">{:/}

    LATTICE
             ALAT=7.1866
             PLAT=    1.000000   0.000000   0.000000
                      0.000000   1.000000   0.000000
                      0.000000   0.000000   1.000000
    SPEC ATOM=Co MMOM=0,0,2.2
    SITE
          ATOM=Pt POS=  0.0  0.0   0.0 
          ATOM=Co POS=  0.5  0.5   0.0 
          ATOM=Co POS=  0.0  0.5   0.5
          ATOM=Co POS=  0.5  0.0   0.5 

{::nomarkdown}</div>{:/}

Then **use the** **blm**{: style="color: blue"} tool (described in more details in [ASA-tutorial](https://lordcephei.github.io/asa-doc/) and [full-potential tutorial](https://lordcephei.github.io/buildingfpinput/). )

~~~
blm --mag --nk=8 --asa --gf copt
~~~

**blm**{: style="color: blue"} should generate file **actrl.copt**{: style="color: green"}, which should be essentially the same as **doc/demos/asa-copt/ctrl.copt**{: style="color: green"} (commented lines might be different though). If this is not the case, something is wrong with your configuration. **You should not continue** if your template does not agree with the one supplied.

The command-line arguments are not required, but they supply quantities **blm**{: style="color: blue"} cannot determine automatically, that you will have to supply at some point. If you supply them on the command-line they are folded into the ctrl file at the outset; or, you can edit the ctrl file after it is generated. Command-line switches **blm**{: style="color: blue"} recognizes are summarized in [Building_FP_input_file.html](https://lordcephei.github.io/buildingfpinput/). 

###### _The --asa switch_

This switch tailors the ctrl file for the ASA. To see how it affects the ctrl file, try running **blm**{: style="color: blue"} without **\-\-asa**{: style="color: green"}. For more details see the [ASA-tutorial](https://lordcephei.github.io/asa-doc/).

###### _The --mag switch_

This switch tells **blm**{: style="color: blue"} that you plan on doing a spin polarized calculation. All it does is change the preprocessor variable _nsp_ to 2. This turns on the spin polarization through **NSPIN={nsp}**.

Without any other information the spin polarized calculation will proceed with zero magnetic moment. You have to supply some initial information about the magnetic structure. Since we know that the magnetization is concentrated on the Co (Pt is paramagnetic, though it has a high magnetic susceptibility), the init file supplies an initial magnetic moment on the Co site of about 2 Bohr on the Co d orbital, in the SPEC category (**SPEC ATOM=Co MMOM=0,0,2.2** in the initial file). Of course the actual magnetic moment is determined self-consistently later.

###### _The --gf switch_

When **\-\-gf**{: style="color: green"} is used, **blm**{: style="color: blue"} prepares the input file for the Green's function program **lmgf**{: style="color: blue"}. This tutorial uses **lmgf**{: style="color: blue"} to calculate magnetic exchange interactions; we'll explaine **lmgf**-related modifications later.



