---
layout: page-fullwidth
title: "ASA Tutorial"
subheadline: ""
show_meta: false
teaser: ""
permalink: "/asa-doc/"
header: no
---
_____________________________________________________________

### _Purpose_
{:.no_toc}
This Tutorial covers the basics running a self consistent LDA calculation in the Atomic Spheres Approximation (ASA), starting with the creation of an input file.  We will use PbTe as the materials


### _Preliminaries_
_____________________________________________________________
Executables **blm**{: style="color: blue"}, **lmchk**{: style="color: blue"}, **lmstr**{: style="color: blue"} and **lm**{: style="color: blue"} are required and are assumed to be in your path.  The source code for all Questaal executables can be found [here](https://bitbucket.org/lmto/lm).

### _Tutorial_
_____________________________________________________________
This tutorial consists of two main sections:

1. Building a suitable input file for an ASA-LDA calculation
2. Running a self consistent calculation

A detailed theoretical description of the ASA and uses of it can be found [here](ASA-notes.pdf).

##### _1\.Building input file_
Under normal atmospherica conditions PbTe crystallises in the rocksalt structure with lattice constant 6.428\angstrom. 
To build an input file, the first step is to construct file _init.ext_{: style="color: green"} (_ext_{: style="color: green"} is replaced by a name of your choosing, usually related to the material being studied, pbte in this case).  _init.pbte_{: style="color: green"} will contain the structural information needed for the calculations demonstrated here. For PbTe the file will look similar to:
    
    LATTICE
	    ALAT=6.427916  UNITS=A
            PLAT=    0.0000000    0.5000000    0.5000000
                     0.5000000    0.0000000    0.5000000
                     0.5000000    0.5000000    0.0000000
    SITE
		ATOM=Pb   X=     0.0000000    0.0000000    0.0000000
		ATOM=Te   X=     0.5000000    0.5000000    0.5000000

The init.pbte file shown above has two sections: lattice and site. The lattice section includes information regarding the lattice structure such as lattice constant (**ALAT=**) and its units (**UNITS**=, \angstrom in this case) plus the primitive lattice translation vectors (**PLAT=**). The site section of the init file includes the basis information, in the case of PbTe this is simply two, one Pb one Te at the position indicated by "X=" (X= indicates positions as fractional multiples of the lattice vectors.  Alternatively you can supply the position with take **POS=**, which specifies positions in Cartesian coordinates, in units of the lattice constant).

Now that the init.pbte file has been created the input file (also referred to as the control file) can be generated easily through

    blm --express=0 --asa --wsitex --findes  init.pbte

This command will generate three new files which are _site.pbte_{: style="color: green"} and _actrl.pbte_{: style="color: green"}, and _log.pbte_{: style="color: green"}.
(The log file keeps track of key information generated by each program and will not be considered here.)  The site file contains structural information in a form the 
Questaal package uses it, and the ctrl file contains all other information needed to carry out a self-consistent calculation (LDA-ASA calculation in this case).
The **blm**{: style="color: blue"} tool which is used to generate the initial control file was invoked using four command line switches.

   --express=0  controls the brevity of the input file (smaller numbers make more verbose files with more information. it is worth experimenting with this switch to find which style of control file you are most confortable with.
   --asa        tells blm that you are preparing to do an ASA calculation
   --wsitex     causes blm to write site positions as fractional multiples of the lattice vectors.
   --findes     causes **blm**{: style="color: blue"} to find empty spheres to fill the unit cell. this is necessary when using ASA as the sum of sphere volumes must equal the cell volume.  The ASA only works well when sites are closely packed.  Close packing of open systems can be artificially accomplished by adding "empty" sites with Z=0.

**blm**{: style="color: blue"} has a number of other command-line switches; type

	blm --h

to see them.

Now the only thing left to do is to rename the input file created to a standard input file Questaal executables read

	cp actrl.pbte ctrl.pbte

##### _2\.Building input file_
If **blm**{: style="color: blue"} was used to find the empty spheres (ES) as indicated in the procedure section 2.1 of the self-consistent calculation can be skipped, however if empty spheres have not been included or have been included manually the procedure below should be followed.


###### _2.1 Empty Spheres_
To check ES and volume packing invoke: 

    lmchk ctrl.pbte

the full output can be viewed by clicking here(waiting for file storing system), however the important informations regarding the volume packing and overlap are towards the end of the stdout and in this particular case it can be seen (in the case of no ES) in one line
    
    Cell volume= 448.07190   Sum of sphere volumes= 301.06511 (0.67191)

here the cell volume, summ of all potential volumes and their ratio are presented, the later of which has to be equal to 1 for an ASA calculation. Another important value is the overlap percentage, which in this cas is given by

      OVMIN, 38 pairs:  fovl = 4.24366e-7   <ovlp> = 8.7%   max ovlp = 8.7%

This line tells us about the average and maximu sphere overlaps, generally for ASA the average should be kept are 10\% while for full qsGW calculation it should be below 4\%. As the sphere overlap is not equal to unity in this case we have to add empty sphere to meet this requirment. Empty spheres are can be thought of as essentially atoms with zero atomic number.
The appropiate space filling spheres can be found using **lmchk**{: style="color: blue"} by invoking:

    lmchk --findes --wsitex ctrl.pbte

here we have used two command-line switches, the first is to invoke the procedure to finde the empty spheres and the second is to write the information into a new site file called "essite.pbte". At the end of  the stdout of the command above you will see the following message:
     
     ... Final sphere sizes and packing fraction (2 new spheres)

     SCLWSR:  mode = 30  vol = 448.072 a.u.   Initial sphere packing = 81.3%  scaled to 100%
     constr omax1=  16.0  18.0  20.0 %    omax2=  40.0 100.0 100.0 %
     actual omax1=   8.7  12.1   0.0 %    omax2=  16.0  24.6   0.0 %

     spec  name        old rmax    new rmax     ratio
        1   Pb          3.300000    3.300000    1.000000
        2   Te          3.300000    3.300000    1.000000
        3   E           1.959808    2.598601    1.325947

which indicates two new empty spheres have been found and are that the new sphere packing is 100\%. The control file has to be changed to reflect the new basis. first change

      NBAS=2+{les?0:0}  NL=4  NSPEC=2+{les?0:0}

to
	
      NBAS=2+{les?2:0}  NL=4  NSPEC=2+{les?1:0}

these two simple logic statments, first one can be interpreted as  "if **les**>0 then  **NBAS=4** else if **les**<0 then **NBAS=2**" and the second "if **les**>0 **NSPEC**=3 else if **les**<0 then **NSPEC=2**", here "les" is a variable which we have defined with in the control file through the following line

      % const nit=10 les=1

here we have also defined nit with value of 10. Next step is to pass the information about the empty sphere sites to the control file, we do this by commenting all instances of **FILE=site** and uncommenting all **FILE=essite** as the new essite.pbte has the new appropiate information, the last stp is to copy the new species information from the poses.pbte file to the SPEC category within the control file (including the new empty spheres).

###### _2.2 Self-consistent_
Before a  self consistant calculation can be preforem the real-space structure constants have to be generated through:

       lmstr ctrl.pbte

the penultimate step is to generate the initial the multiple moments Q$_0$,Q$_1$,Q$_2$, for this we first change the nkabc variable within the control file to for (**nkabc=4**, this variable represents the k-mesh density):
change 
	
	% const nkabc=0
	
to

	% const nkabc=4


next  the  **lm**{: style="color: blue"} executable is invoked with zero number of iterations such that

    lm -vnit=0 ctrl.pbte

and lastly for a fully consistant LDA-ASA calculation **lm**{: style="color: blue"} is invoked with **-vnit**>1 so that

    lm -vnite=20 ctrl.pbte

the message at the end of the standard out put will indicate if selfconsistency has been achieved which in this case it has.
	    
